<% provide(:title, "Lucene Console") %>
<div class="wrapper wrapper-content animated fadeInRight">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-content text-center p-md">
          <h2><span class="text-navy">数据检索</span>
            <br>
            </h2>
          <p>
           
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
  <div class="col-md-4 codeEditor">
    <div class="jsoneditor">
      <div class="jsoneditor-menu">
        <div class="input-group">
          <span class="input-group-addon"><i class="fa fa-search"></i></span>
          <input type="text" placeholder="请输入索引名称" id="index_name" class="form-control">
        </div>
      </div>
      <div class="jsoneditor-outer">
        <pre>
          <code class="json" id="query_opts" contenteditable="true"></code>
        </pre>
      </div>
    </div>
    <p class="text-center"><button type="button" class="btn btn-w-m btn-primary" id="submit_btn">搜索</button></p>
  </div>
  <div class="col-md-8 treeEditor">
    <div class="jsoneditor">
      <div class="jsoneditor-outer" id="results"></div>
    </div>
  </div>
</div>
</div>


<% content_for :javascript do %>
  <script type="text/javascript">
    $(function() {

    $("#submit_btn").on('click',function(e){
      var query_opts = $('#query_opts').text();
      $("#query_opts").text(JSON.stringify($.parseJSON( query_opts ),null,2));

      var snippet = document.querySelector('#query_opts');
      
      hljs.highlightBlock(snippet);
      var index_name = $("#index_name").val();
     if (index_name.length<1)
        {
           sweetAlert("", "请输入索引名称！", "warning");
        }else{
            $.ajax({
              url: '/lucene/search',
              type: 'GET',
              data:{index_name:index_name,query_opts:query_opts},
              success:function(data){
              if (data.type=="success"){
                $("#results").JSONView(eval(data.results), { collapsed: false });
                
              }else{
                sweetAlert("", data.message, "warning");
              }
            }});
        }
     
    });
    
    });
  </script>
<% end %>