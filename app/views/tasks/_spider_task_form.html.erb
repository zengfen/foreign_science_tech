<div class="row">
  <div class="col-lg-12">
    <div class="ibox float-e-margins">
      <div class="ibox-content">
        <!-- 添加form -->
        <%= form_for(@spider_task,url: "",:html=>{:class=>"form-horizontal spider-task-form"}) do |f| %>
          <div class="form-group">
            <label class="col-sm-2 control-label">选择模版</label>
            <div class="col-sm-8">
              <%= f.select(:spider_id,Spider.all.collect{|x| [x.spider_name,x.id]},{include_blank: "请选择模版"},{class: "form-control m-b spider",:onchange=>"get_spider()"}) %>
            </div>
            <div class="col-sm-2">
              <i class="fa fa-info-circle m-sm" data-toggle="tooltip"  data-placement="bottom" title="请先选择模板" id="btn_ins"></i>
            </div>
          </div>
          <div class="hr-line-dashed"></div>
          <div class="keywords_inputs"></div>
          <div class="time_limits"></div>
          <div class="form-group">
            <label class="col-sm-2 control-label">优先级</label>
            <div class="col-sm-10">
              <div id="iconrange_spider_task_level_num"></div>
              <%= f.hidden_field :level,:class=>"level_num"%>
            </div>
          </div>
          <div class="hr-line-dashed"></div>
          <div class="form-group">
            <label class="col-sm-2 control-label">重试次数</label>
            <div class="col-sm-10">
              <div id="iconrange_spider_task_retry_num"></div>
              <%= f.hidden_field :max_retry_count, :class=>"retry_num", :value => 0%>
            </div>
          </div>
          <div class="hr-line-dashed"></div>
          <div class="form-group">
            <label class="col-sm-2 control-label">超时时间(秒)</label>
            <div class="col-sm-10">
              <div id="iconrange_spider_task_timeout_second"></div>
              <%= f.hidden_field :timeout_second, :class=>"timeout_second", :value => 5%>
            </div>
          </div>
          <div class="hr-line-dashed"></div>
          <div class="form-group">
            <label class="col-sm-2 control-label">特殊标签</label>
            <div class="col-sm-10">
              <%= f.text_field :special_tag,:placeholder=>"特殊标签",:class=>"form-control"%>
            </div>
          </div>
          <div class="hr-line-dashed"></div>
          <div class="tags_inputs"></div>
          <div class="form-group">
            <div class="col-sm-2 col-sm-offset-10">
              <button class="btn btn-primary submit_btn" type="button">保存</button>
            </div>
          </div>
        <%end%>
      </div>
    </div>
  </div>
</div>
<div class="hide keywords">
  <div class="form-group ">
    <label class="col-sm-2 control-label">关键词</label>
    <div class="col-sm-10">
      <textarea  class="form-control" type="text" rows="15" name="spider_task[keyword]" id="spider_task_keyword" placeholder="输入关键词(多关键词以英文','分割)"></textarea>
    </div>
  </div>
  <div class="hr-line-dashed"></div>
  <div class="form-group">
    <label class="col-sm-2 control-label">是否切分</label>
    <div class="col-sm-10">
      <div class="i-checks inline">
        <label class="control-label">
          <input type="radio" name="spider_task[is_split]" checked="checked" value="0" />
          <i></i> 不切分
        </label>
      </div>
      <div class="i-checks inline">
        <label class="control-label">
          <input type="radio" name="spider_task[is_split]" value="1" />
          <i></i> 切分
        </label>
      </div>
    </div>
  </div>
  <div class="hr-line-dashed"></div>
  <div class="form-group">
    <label class="col-sm-2 control-label">分组数量</label>
    <div class="col-sm-10">
      <input type="text" value="-1" name="spider_task[split_group_count]" class="form-control" id=""/>
    </div>
  </div>
  <div class="hr-line-dashed"></div>
</div>
<% content_for :javascript do %>
  <script type="text/javascript">
    function get_spider () {
      var spider_id = $('#spider_task_spider_id').val();
      if (spider_id!=""){
        url  = '/spiders/'+ spider_id +'/spider_tasks'
        $('.spider-task-form').attr('action',url);
        $.ajax({
          url:"/tasks/get_spider",
          data:{id:spider_id},
          type:"get",
          dataType:"json",
          success:function(result){
            if (result.type=="true"){
              $(".keywords_inputs").html($('.keywords').html());
            }else{
              $(".keywords_inputs").html('');
            }

            $(".tags_inputs").html(result.add_funs);
            $(".time_limits").html(result.time_limits);

            $("#btn_ins").attr("title",result.instruction).tooltip('fixTitle').tooltip('show');
          }
        });
      }else{
        $(".keywords_inputs").html('');
        $(".tags_inputs").html('');
        $(".time_limits").html('');
        $("#btn_ins").attr("title","请先选择模板").tooltip('fixTitle').tooltip('show');
      }

    }
    $("#iconrange_spider_task_level_num").ionRangeSlider({
      min: 1,
      max: 10,
      //postfix: "",
      grid: true,
      grid_num: 9,
      onFinish: function (data) {
        $(".level_num").val(data.from);
      }
    });
    $("#iconrange_spider_task_retry_num").ionRangeSlider({
      min: 0,
      max: 9,
      //postfix: "",
      grid: true,
      grid_num: 9,
      onFinish: function (data) {
        $(".retry_num").val(data.from);
      }
    });
    $("#iconrange_spider_task_timeout_second").ionRangeSlider({
      min: 1,
      max: 15,
      from: 5,
      //postfix: "",
      grid: true,
      grid_num: 14,
      onFinish: function (data) {
        $(".timeout_second").val(data.from);
      }
    });

    $(function() {
      $('form.spider-task-form .i-checks').iCheck({
        checkboxClass: 'icheckbox_square-green',
        radioClass: 'iradio_square-green',
      });

    });
  </script>
<%end%>
