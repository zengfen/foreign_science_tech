<% provide(:title, "Host") %>
<div class="wrapper wrapper-content animated fadeInRight">
  <div class="row">

    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>主机</h5>
        </div>

        <div class="ibox-content pl15">
          <div class="bg-search">
            <%=form_tag url_for(action: :index),:class=>"-form-horizontal",:method=>:get do%>
              <div id="rcontent" class="clear-p">

                <div class="col-md-7">
                  <div class="form-group mb0">

                    <input type="text" placeholder="IP" name="keyword" class="form-control pl40" value="<%= params[:keyword] %>">
                    <i class="search-line" style=></i>
                    <i class="fa fa-search search-icon"></i></div>
                </div>
                <div class="col-md-3">
                  <div class="form-group mb0">
                    <%=select_tag(:services,options_for_select(Host.services.invert.to_a,params["services"]),:class=>"form-control chosen-select",multiple: true)%>
                  </div>
                </div>

                <div class="ibox-tools dib">
                  <input type="submit" class="btn btn-primary btn-warning w70 mb0" value="搜索">
                  <!-- <a class="btn btn-primary btn-warning w70 mb0">
                    搜索</a> -->
                </div>
                <div class="ibox-tools fr">
                  <a class="btn btn-primary mb0" href="/commands/new" style="display: inline-block ;float: left"><i class="fa fa-plus"></i>
                    添加命令</a>

<!--                   <a class="btn btn-primary " href="#" >
                    按钮2</a> -->
                </div>
              </div>

            <%end%>
          </div>
        </div>
        <div id="result_release">
          <div class="ibox-content table-sql">
            <ul class="tab-ul clear-p">
              <li class="tab-li active">
                <a href="#" data-target="all-page">全部主机列表</a>
              </li>
            </ul>

            <div class="ibox-content p15-0 all-page table-content">
              <table class="table table-striped table-bordered table-hover table-vcenter">
                <thead>
                  <tr>
                    <th class="text-center">主机IP</th>
                    <th class="text-center">国家</th>
                    <th class="text-center">心跳时间</th>
                    <th class="text-center">安装服务</th>
                    <th class="text-center">在线服务</th>
                    <th class="text-center">操作</th>
                  </tr>
                </thead>
                <tbody class="text-center">
                  <% @hosts.each do |h| %>
                    <tr>
                      <td><%= h.extranet_ip.to_s %></td>
                      <td><%= h.network_environment_cn %></td>
                      <td><%= time_ago_in_words(h.recording_time) %>前</td>
                      <td data-toggle="tooltip"  data-container="body" data-placement="bottom" title="<%=h.service_cn.join(',')%>"><%= h.host_service.count%></td>
                      <td data-toggle="tooltip"  data-container="body"  data-placement="bottom" title="<%=h.online_services_cn.join(',')%>"><%= h.online_services_cn.count%></td>
                      <td><a href="#" >查看</a></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
              <div class="text-center">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <% content_for :javascript do %>
    <script>

$(document)
.on("click",".tab-li a",function(e){
  e.preventDefault();
  var $this = $(this);
  if ($this.find('.icon-result').length > 0) return;
  var targetClass = $this.data('target');
  var $thisP = $this.closest('.ibox-content');
  $this.closest('li').addClass('active').siblings('li').removeClass('active');
  $thisP.children('.ibox-content').addClass('dn');
  $thisP.children('.' + targetClass).removeClass('dn');
  $('.more-ul').addClass('dn');

  if (targetClass) {
    var url = $this.attr("href");
    if (url != "##") {
      $("#current_url").val(url);
      $.get(url, function (data) {
        $("." + targetClass).html(data);
      })
      return false;
    }
  }
})
.on("click",'.icon-more',function(e){
   e.preventDefault();
    var $this = $(this), $thisMoreUl = $this.closest('td').find('.more-ul');
    var isDn = $thisMoreUl.hasClass('dn');
    $('.more-ul').addClass('dn');
    if (isDn) {
      $thisMoreUl.removeClass('dn');
    }
    //点击其他的地方关闭更多
    $(document).on('click', function moreShow(e) {
      var $target = $(e.target)
        if ($target.closest('.pos-r').length == 0) {
          $('.more-ul').addClass('dn');
          $(document).off('click', moreShow);
        }
    })
})


 $('.chosen-select').chosen({width: "100%",disable_search_threshold: 10000,placeholder_text_multiple:"选择已安装服务",disable_search:true});
 $("[data-toggle='tooltip']").tooltip();
 
    </script>
  <% end %>
